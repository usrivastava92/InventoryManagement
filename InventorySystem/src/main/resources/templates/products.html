<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">

<head>
  <title>R.I.M.S</title>
  <meta charset="utf-8" />
  <meta content="ie=edge" http-equiv="x-ua-compatible" />
  <meta content="template language" name="keywords" />
  <meta content="Tamerlan Soziev" name="author" />
  <meta content="R.I.M.S" name="description" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link href="/assets/img/favicon.png" rel="shortcut icon" />
  <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon" />
  <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500" rel="stylesheet" type="text/css" />
  <link href="/assets/bower_components/select2/dist/css/select2.min.css" rel="stylesheet" />
  <link href="/assets/bower_components/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet" />
  <link href="/assets/bower_components/dropzone/dist/dropzone.css" rel="stylesheet" />
  <link href="/assets/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
  <link href="/assets/bower_components/fullcalendar/dist/fullcalendar.min.css" rel="stylesheet" />
  <link href="/assets/bower_components/perfect-scrollbar/css/perfect-scrollbar.min.css" rel="stylesheet" />
  <link href="/assets/bower_components/slick-carousel/slick/slick.css" rel="stylesheet" />
  <link href="/assets/css/main.css?version=4.4.0" rel="stylesheet" />
  <link href="/assets/icon_fonts_assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
</head>

<body class="menu-position-side menu-side-left full-screen">
  <div class="all-wrapper with-side-panel solid-bg-all">
    <div th:replace="fragments/top-menu-search :: top-menu-search">
      top-menu-search
    </div>
    <div class="layout-w">
      <!--------------------
          START - Mobile Menu
          -------------------->
      <div th:replace="fragments/mobile-menu :: mobile-menu">
        mobile-menu
      </div>
      <!--------------------
          END - Mobile Menu
          -------------------->
      <!--------------------
          START - Main Menu
          -------------------->
      <div th:replace="fragments/side-menu :: side-menu">
        side-menu
      </div>
      <!--------------------
          END - Main Menu
          -------------------->
      <div class="content-w">
        <!--------------------
              START - Top Bar
              -------------------->
        <div th:replace="fragments/top-menu :: top-menu">
          top-menu
        </div>
        <!--------------------
              END - Top Bar
              -------------------->
        <!--------------------
              START - Breadcrumbs
              -------------------->
        <ul class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/index.html">Home</a>
          </li>
          <li class="breadcrumb-item">
            <a href="/product">Products</a>
          </li>
        </ul>
        <!--------------------
              END - Breadcrumbs
              -------------------->
        <div class="content-i">
          <div class="content-box">
            <div class="element-wrapper">
              <h6 class="element-header">
                Products
              </h6>
              <div class="element-box">
                <form id="formValidate">
                  <fieldset class="form-group">
                    <legend><span>Filter Products</span></legend>
                    <div class="row">
                      <div class="form-group col-md-2 col-lg-3">
                        <label for="parentCategory1">Category-1</label>
                        <select class="ajax-dropdown form-control" id="parentCategory1">
                        </select>
                      </div>
                      <div class="form-group col-md-2 col-lg-3">
                        <label for="parentCategory2">Category-2</label>
                        <select class="ajax-dropdown form-control" id="parentCategory2">
                        </select>
                      </div>
                      <div class="form-group col-md-2 col-lg-3">
                        <label for="subCategory1">Category-3</label>
                        <select class="ajax-dropdown form-control" id="subCategory1">
                        </select>
                      </div>
                      <div class="form-group col-md-2 col-lg-3">
                        <label for="subCategory2">Category-4</label>
                        <select class="ajax-dropdown form-control" id="subCategory2">
                        </select>
                      </div>
                    </div>
                  </fieldset>
                </form>
                <hr />
                <h5 class="form-header">
                  Product Records
                </h5>
                <div class="form-desc"></div>
                <div class="table-responsive">
                  <table id="productRecords" width="100%" class="table table-striped table-lightfont">
                    <thead>
                      <tr>
                        <th>Sno.</th>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Creation Time</th>
                        <th>Approval Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tfoot>
                      <tr>
                        <th>Sno.</th>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Creation Time</th>
                        <th>Approval Status</th>
                        <th>Actions</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
            <div th:replace="fragments/overdraw-elements :: overdraw-elements">
              overdraw-elements
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="display-type"></div>
  </div>
  <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/assets/bower_components/popper.js/dist/umd/popper.min.js"></script>
  <script src="/assets/bower_components/moment/moment.js"></script>
  <script src="/assets/bower_components/chart.js/dist/Chart.min.js"></script>
  <script src="/assets/bower_components/select2/dist/js/select2.full.min.js"></script>
  <script src="/assets/bower_components/jquery-bar-rating/dist/jquery.barrating.min.js"></script>
  <script src="/assets/bower_components/ckeditor/ckeditor.js"></script>
  <script src="/assets/bower_components/bootstrap-validator/dist/validator.min.js"></script>
  <script src="/assets/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
  <script src="/assets/bower_components/ion.rangeSlider/js/ion.rangeSlider.min.js"></script>
  <script src="/assets/bower_components/dropzone/dist/dropzone.js"></script>
  <script src="/assets/bower_components/editable-table/mindmup-editabletable.js"></script>
  <script src="/assets/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
  <script src="/assets/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
  <script src="/assets/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
  <script src="/assets/bower_components/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>
  <script src="/assets/bower_components/tether/dist/js/tether.min.js"></script>
  <script src="/assets/bower_components/slick-carousel/slick/slick.min.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/util.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/alert.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/button.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/carousel.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/collapse.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/dropdown.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/modal.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/tab.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/tooltip.js"></script>
  <script src="/assets/bower_components/bootstrap/js/dist/popover.js"></script>
  <script src="/assets/js/dataTables.bootstrap4.min.js"></script>
  <script src="/assets/js/demo_customizer.js?version=4.4.0"></script>
  <script src="/assets/js/main.js?version=4.4.0"></script>
  <script>
    (function (i, s, o, g, r, a, m) {
      i["GoogleAnalyticsObject"] = r;
      (i[r] =
        i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        }),
        (i[r].l = 1 * new Date());
      (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m);
    })(
      window,
      document,
      "script",
      "https://www.google-analytics.com/analytics.js",
      "ga"
    );

    ga("create", "UA-XXXXXXX-9", "auto");
    ga("send", "pageview");
  </script>
  <script>
    $(document).ready(function () {
      $("select").select2();

      var elementId = "parentCategory1";
      var filterJson = {};
      filterJson["element"] = elementId;

      populateDropdown(elementId, filterJson);

      $(".ajax-dropdown").change(function () {
        var requestJson = {};
        var nextElementIndex = $(".ajax-dropdown").index(this) + 1;
        var nextElementId = null;
        var filterJson = {};
        $(".ajax-dropdown").each(function (index, value) {
          if (index < nextElementIndex) {
            filterJson[this.id] = this.value;
          } else {
            $(this).html("");
            if (index == nextElementIndex) {
              nextElementId = this.id;
            }
          }
        });
        if (nextElementId != null) {
          requestJson["element"] = nextElementId;
          requestJson["filterJson"] = filterJson;
          populateDropdown(nextElementId, requestJson);
        } else {
          populateProductRecords(filterJson);
        }
      });

      function populateDropdown(elementId, requestJson) {
        console.log(requestJson);
        $.ajax({
          url: "/products/populatefilter",
          type: "post",
          data: JSON.stringify(requestJson),
          dataType: "json",
          contentType: "application/json",
          success: function (data) {
            addOptionsToElement(elementId, data);
          },
          error: function (e) {
            console.log(e);
          }
        });
      }

      function addOptionsToElement(elementId, data) {
        var element = $("#" + elementId);
        element.html("<option value='choose'>-- select --</option>");
        $.each(data, function (key, value) {
          element.append(
            '<option value="' + value + '">' + value + "</option>"
          );
        });
        element.focus();
      }

      var datatable = $("#productRecords").DataTable({
        aoColumns: [
          {
            mDataProp: "id",
            bSortable: true
          },
          {
            mDataProp: "code",
            bSortable: true,
            mRender: function (data, type, row) {
              return (
                "<a href='/product/get/" + row.id + "'>" + data + "</a>"
              );
            }
          },
          {
            mDataProp: "name",
            bSortable: true
          },
          {
            mDataProp: "creationTimeStamp",
            bSortable: true,
            mRender: function (data, type, row) {
              return (
                data
              );
            }
          },
          {
            mDataProp: "approvalStatus",
            bSortable: true
          },
          {
            mDataProp: "id",
            bSortable: false,
            mRender: function (data, type, full) {
              return (
                "<a href='/product/get/" +
                data +
                "'><i data-placement='top' data-toggle='tooltip' title='Edit record' class='fa text--green fa-pencil-square fa-2x'></i></a>&nbsp;<a data-placement='top' data-toggle='tooltip' title='Mark for deletion' href='/product/remove/" +
                data +
                "'><i class='text--orange fa fa-times-circle fa-2x'></i></a>"
              );
            }
          }
        ]
      });

      /*datatable.on('click', 'tr', function () {
        var data = datatable.row(this).data();
      });*/

      function populateProductRecords(filterJson) {
        $.ajax({
          type: "POST",
          contentType: "application/json",
          url: "/products/filter",
          data: JSON.stringify(filterJson),
          dataType: "json",
          timeout: 100000,
          success: function (data) {
            populateDataTable(data);
          },
          error: function (e) {
            console.log("ERROR: ", e);
          },
          done: function (e) {
            console.log("DONE");
          }
        });
      }

      function populateDataTable(data) {
        datatable.clear().draw();
        datatable.rows.add(data);
        datatable.columns.adjust().draw();
      }

    });
  </script>
</body>

</html>